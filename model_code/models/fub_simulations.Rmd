---
title: "Familiarity-Uncertainty biased Global model (Kachergis et al, 2012)"
author: "Christine Soh Yue"
date: "2025-09-18"
output: 
  html_document:
    toc: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r requirements}
library(pso)
library(tidyverse)
```

# Model
These models are copied from Kachergis' word github. There is one modification
that we make -- to remove the cross-initialization that results in a 
target-referent bias in the first exposure.
```{r model}
source("kachergis.R")
```

# Simulations

Here, we run simulations on 4 different studies.

## Trueswell, Medina, Hafri, & Gleitman, 2013

### Input
Trueswell input: 12 words, 5 exposures interleaved

Human performance is approximated using the published values
```{r trueswell_words_objs}
trueswell_words <- matrix(c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,
                            1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,
                            1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,
                            1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,
                            1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12
                       ),
                     nrow = 60,
                     ncol = 1, byrow=T
                     )


trueswell_obj <- matrix(c(1, 5, 2, 7, 3,      2, 3, 12, 9, 6,    3, 4, 2, 8, 10,   
                          4, 7, 11, 9, 1,     5, 8, 10, 12, 6,   6, 5, 4, 11, 10, 
                          7, 11, 6, 10, 4,    8, 1, 4, 2, 3,     9, 11, 7, 2, 10, 
                          10, 8, 2, 3, 11,   11, 2, 5, 8, 7,    12, 1, 5, 10, 8, 
                          1, 6, 2, 12, 8,     2, 4, 3, 10, 11,   3, 12, 11, 9, 1, 
                          4, 12, 6, 2, 8,     5, 4, 7, 3, 2,     6, 7, 4, 3, 1, 
                          7, 3, 2, 12, 5,     8, 9, 11, 4, 6,    9, 11, 10, 5, 6, 
                          10, 1, 12, 11, 8,  11, 5, 3, 10, 9,   12, 9, 3, 2, 11,
                          1, 12, 7, 10, 9,    2, 7, 1, 10, 4,    3, 6, 9, 7, 4, 
                          4, 7, 3, 12, 1,     5, 6, 3, 7, 4,     6, 8, 7, 5, 9, 
                          7, 11, 1, 5, 9,     8, 12, 6, 10, 5,   9, 8, 2, 3, 4, 
                          10, 6, 12, 9, 1,    11, 12, 10, 6, 9,  12, 7, 8, 2, 11, 
                          1, 4, 8, 5, 3,    2, 1, 6, 8, 7,    3, 5, 12, 7, 2, 
                          4, 10, 9, 2, 5,     5, 2, 1, 8, 9,     6, 3, 12, 10, 1, 
                          7, 2, 12, 6, 9,     8, 11, 7, 5, 1,    9, 8, 12, 6, 3, 
                          10, 5, 3, 7, 4,     11, 1, 3, 6, 4,    12, 1, 6, 10, 7, 
                          1, 11, 10, 9, 6,     2, 8, 9, 11, 5,    3, 5, 11, 1, 8, 
                          4, 6, 10, 3, 11,    5, 12, 1, 11, 10,    6, 12, 8, 11, 9, 
                          7, 1, 10, 4, 8,      8, 12, 7, 2, 3,     9, 5, 4, 12, 7, 
                          10, 9, 2, 5, 4,      11, 4, 1, 2, 8,     12, 9, 6, 5, 4
                       ),
                     nrow = 60,
                     ncol = 5, byrow=T
                     )
```

```{r trueswell_input}
trueswell <- list("train" = list("words" = trueswell_words, 
                                 "objs" = trueswell_obj), 
                  "Nsubj" = 40, 
                   "Condition" = "Trueswell", 
                   "HumanItemAcc" = c(0.333, 0.333, 0.333, 0.333, 0.333, 0.333,
                                      0.333, 0.333, 0.333, 0.333, 0.333, 0.333)
                  )
```

### Test and fit functions

The test function is defined separately: in the Trueswell et. al. work, there
isn't a final test.
```{r trueswell_test}
test_model_trueswell <- function(expt, params) {
  mod = run_model(expt, params, print_perf=F)
  
  words = expt$train$words
  objs = expt$train$objs
  test_performance = matrix(0, 1, nrow(words))
  for(test_row in 1:nrow(words)) {
    test_options = as.integer(objs[test_row,])
    trajectory = mod$traj[test_row][[1]]
    numerator = trajectory[test_options[1], test_options[1]]
    denominator = 0
    for(option in test_options) {
      denominator = denominator + trajectory[test_options[1], option]
    }
    test_performance[1,test_row] = numerator / denominator
  }
                      
  return(test_performance)
}
```

We define the Mean SSE function to compare the final exposure

```{r trueswell_fit}
meanSSE_trueswell <- function(par, order, human_perf) {
  mod = test_model_trueswell(order, par)
  return(sum((mod[1, 49:60]-human_perf)^2))
}

trueswell_mod_fit <- fit_model("kachergis", trueswell, c(.001,.1,.5), c(5,15,1), meanSSE_trueswell)
```


### Fit to entire trajectory
```{r trueswell_fit_entire}
meanSSE_trueswell_full <- function(par, order, human_perf) {
  mod = test_model_trueswell(order, par)
  return(sum((mod-human_perf)^2))
}

trueswell_full <- list("train" = list("words" = trueswell_words, 
                                 "objs" = trueswell_obj), 
                  "Nsubj" = 40, 
                   "Condition" = "Trueswell", 
                   "HumanItemAcc" = c(0.178, 0.178, 0.178, 0.178, 0.178, 0.178, 
                                      0.178, 0.178, 0.178, 0.178, 0.178, 0.178, 
                                      
                                      0.222, 0.222, 0.222, 0.222, 0.222, 0.222, 
                                      0.222, 0.222, 0.222, 0.222, 0.222, 0.222, 
                                      
                                      0.272, 0.272, 0.272, 0.272, 0.272, 0.272, 
                                      0.272, 0.272, 0.272, 0.272, 0.272, 0.272, 
                                      
                                      0.311, 0.311, 0.311, 0.311, 0.311, 0.311,
                                      0.311, 0.311, 0.311, 0.311, 0.311, 0.311,
                                      
                                      0.333, 0.333, 0.333, 0.333, 0.333, 0.333,
                                      0.333, 0.333, 0.333, 0.333, 0.333, 0.333)
                  )

trueswell_mod_full_fit <- fit_model("kachergis", trueswell_full, c(.001,.1,.5), c(5,15,1), meanSSE_trueswell_full)
```

### Results
```{r trueswell_results}
trueswell_results <- test_model_trueswell(trueswell, trueswell_mod_fit)
print("fubg")
mean(trueswell_results[1,13:60])
print("trajectory")
paste0(round(c(mean(trueswell_results[1, 1:12]), mean(trueswell_results[1, 13:24]),
  mean(trueswell_results[1, 25:36]), mean(trueswell_results[1, 37:48]),
  mean(trueswell_results[1, 49:60])), 3), collapse=", ")
```

```{r trueswell_full_trajectory_results}
trueswell_full_fit_results <- test_model_trueswell(trueswell, trueswell_mod_full_fit)
print("fubg trained on trajectory")
mean(trueswell_full_fit_results[1,13:60])
print("trajectory")
paste0(round(c(mean(trueswell_full_fit_results[1, 1:12]), 
               mean(trueswell_full_fit_results[1, 13:24]),
               mean(trueswell_full_fit_results[1, 25:36]), 
               mean(trueswell_full_fit_results[1, 37:48]),
               mean(trueswell_full_fit_results[1, 49:60])), 3), 
       collapse=", ")
```

## Yurovsky & Yu, 2008
### Input
We generate this from the published work -- the actual input may be slightly 
different.

There are two different object inputs: massed (obj1) and interleaved (obj2)
```{r yy_words_objs}
yy_words <- matrix(c(1, 3, 2, 11,   2, 9, 4, 5,   4, 7, 6, 1, 
                     6, 2, 12, 3,   3, 1, 4, 12,  1, 5, 6, 8, 
                     6, 4, 11, 2,   10, 1, 5, 3,  2, 5, 8, 4, 
                    10, 9, 6, 2,   1, 5, 7, 11,  3, 5, 10, 6, 
                     4, 10, 3, 5,   4, 3, 8, 1,   12, 2, 5, 8, 
                     1, 3, 6, 12,   2, 7, 3, 4,   3, 2, 11, 8, 
                    11, 5, 6, 4,   2, 10, 1, 4,  4, 9, 1, 12, 
                     8, 3, 9, 6,    4, 6, 10, 7,  1, 9, 2, 6, 
                     3, 5, 9, 7,    2, 5, 1, 7,   6, 5, 11, 12 
                    ),
                    nrow = 27,
                    ncol = 4, byrow=T
                    )

yy_obj1 <- matrix(c( 1, 11, 3, 2,    9, 5, 4, 2,      16, 6, 7, 1,
                     3, 2, 6, 12,    3, 4, 12, 1,     8, 6, 5, 1,
                     6, 4, 11, 2,    1, 3, 10, 5,     4, 8, 5, 2,
                     6, 9, 2, 10,     11, 5, 7, 1,     6, 5, 3, 10,
                    17, 10, 4, 3,    15, 8, 13, 16,   12, 14, 17, 8,
                    12, 18, 15, 13,  7, 16, 14, 15,   8, 11, 14, 15,
                    11, 17, 16, 18,  10, 14, 16, 13,  9, 12, 13, 16,
                    18, 8, 15, 9,    16, 10, 7, 18,   13, 9, 18, 14,
                    15, 7, 9, 17,    14, 17, 13, 7,    18, 11, 12, 17
                    ), 
                    nrow = 27,
                    ncol = 4, byrow=T
                    )

yy_obj2 <- matrix(c( 1, 11, 3, 2,    9, 5, 4, 14,     16, 6, 7, 13,
                    15, 2, 18, 12,   3, 4, 12, 1,     8, 6, 17, 13,
                    18, 16, 11, 14,  1, 15, 10, 5,    4, 8, 17, 2,
                     6, 9, 14, 10,    11, 5, 7, 13,    18, 17, 3, 10,
                     5, 10, 16, 15,   3, 8, 1, 4,      12, 2, 17, 8,
                    12, 6, 15, 13,   7, 16, 14, 3,    8, 11, 2, 15,
                    11, 5, 4, 18,    10, 14, 16, 1,   9, 12, 13, 4,
                     6, 8, 3, 9,      16, 10, 7, 18,   1, 9, 6, 2,
                    15, 7, 9, 17,    14, 5, 13, 7,    18, 11, 12, 17
                    ), 
                    nrow = 27,
                    ncol = 4, byrow=T
                    )
```

There are three different tests: primacy, recency, and both. To output the 
"both" test results, we run the double meaning items twice -- once with the 
first meaning and once with the second meaning. The FUbG model at test
just draws from the final trajectory, so separating it like this doesn't
make a difference.
```{r yy_test_input}
yy_test_words <- matrix(c(
  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6
),
nrow = 18,
ncol = 1, byrow = T)

yy_test_primacy <- matrix(c(
  1, 7, 9, 18,     2, 12, 17, 1,    3, 17, 16, 13,
  4, 10, 9, 7,     5, 4, 11, 14,    6, 10, 1, 15,
  7, 18, 8, 4,     8, 14, 11, 15,   9, 2, 17, 5,
  10, 13, 3, 2,    11, 16, 6, 12,   12, 8, 6, 15,
  # DUMMY
  1, 7, 9, 18,     2, 12, 17, 1,    3, 17, 16, 13,
  4, 10, 9, 7,     5, 4, 11, 14,    6, 10, 1, 15
),
nrow = 18,
ncol = 4, byrow = T)


yy_test_recency <- matrix(c(
  13, 7, 9, 6,    14, 12, 5, 1,     15, 17, 4, 1,
  16, 10, 9, 7,   17, 4, 11, 2,     18, 10, 1, 15,
  7, 18, 8, 4,    8, 14, 11, 3,     9, 2, 17, 5,
  10, 13, 3, 2,   11, 16, 6, 12,    12, 8, 6, 15,
  # DUMMY
  13, 7, 9, 6,    14, 12, 5, 1,     15, 17, 4, 1,
  16, 10, 9, 7,   17, 4, 11, 2,     18, 10, 1, 15
),
nrow = 18,
ncol = 4, byrow = T)

yy_test_both <- matrix(c(
  1, 13, 7, 9,     2, 14, 12, 1,     3, 15, 17, 1,
  4, 16, 10, 9,    5, 17, 4, 11,     6, 18, 10, 15,
  
  7, 18, 8, 4,     8, 14, 11, 3,     9, 2, 17, 5,
  10, 13, 3, 2,    11, 16, 6, 12,    12, 8, 6, 15,
  
  13, 1, 7, 9,     14, 2, 12, 1,     15, 3, 17, 1,
  16, 4, 10, 9,    17, 5, 4, 11,     18, 6, 10, 15
),
nrow = 18,
ncol = 4, byrow = T)
```

```{r yu_yurovsky_input}
yy_1_primacy <- list("train" = list("words" = yy_words, "objs" = yy_obj1), 
                             "Nsubj" = 40, 
                             "Condition" = "Yurovsky_expt1_primacy", 
                             "HumanItemAcc" = c(0.580, 0.580, 0.580, 0.580, 0.580, 0.580,
                                                0.642, 0.642, 0.642, 0.642, 0.642, 0.642))

yy_1_recency <- list("train" = list("words" = yy_words, "objs" = yy_obj1), 
                             "Nsubj" = 40, 
                             "Condition" = "Yurovsky_epxt1_recency", 
                             "HumanItemAcc" = c(0.510, 0.510, 0.510, 0.510, 0.510, 0.510,
                                                0.642, 0.642, 0.642, 0.642, 0.642, 0.642))

yy_1_both <- list("train" = list("words" = yy_words, "objs" = yy_obj1), 
                             "Nsubj" = 40, 
                             "Condition" = "Yurovsky_expt1_both", 
                             "HumanItemAcc" = c(0.524, 0.524, 0.524, 0.524, 0.524, 0.524,
                                                0.642, 0.642, 0.642, 0.642, 0.642, 0.642,
                                                0.292, 0.292, 0.292, 0.292, 0.292, 0.292))

yy_1_expt <- list("primacy" = yy_1_primacy,
                 "recency" = yy_1_recency,
                 "both" = yy_1_both,
                 "Condition" = "Yurovsky_expt1")

yy_2_primacy <- list("train" = list("words" = yy_words, "objs" = yy_obj2), 
                             "Nsubj" = 40, 
                             "Condition" = "Yurovsky_expt2_primacy", 
                             "HumanItemAcc" = c(0.524, 0.524, 0.524, 0.524, 0.524, 0.524,
                                                0.521, 0.521, 0.521, 0.521, 0.521, 0.521))

yy_2_recency <- list("train" = list("words" = yy_words, "objs" = yy_obj2), 
                             "Nsubj" = 40, 
                             "Condition" = "Yurovsky_expt2_recency", 
                             "HumanItemAcc" = c(0.517, 0.517, 0.517, 0.517, 0.517, 0.517,
                                                0.582, 0.582, 0.582, 0.582, 0.582, 0.582))

yy_2_both <- list("train" = list("words" = yy_words, "objs" = yy_obj2), 
                             "Nsubj" = 40, 
                             "Condition" = "Yurovsky_expt2_both", 
                             "HumanItemAcc" = c(0.350, 0.350, 0.350, 0.350, 0.350, 0.350,
                                                0.575, 0.575, 0.575, 0.575, 0.575, 0.575,
                                                0.377, 0.377, 0.377, 0.377, 0.377, 0.377))

yy_2_expt <- list("primacy" = yy_2_primacy, 
                 "recency" = yy_2_recency, 
                 "both" = yy_2_both,
                 "Condition" = "Yurovsky_expt2")

yy_expt <- list("one" = yy_1_expt,
              "two" = yy_2_expt,
              "Condition" = "Yurovsky")
```

### Fit functions
```{r yu_yurovsky_sse_fn}
yy_meanSSE_primacy <- function(par, order, human_perf) {
  mod = test_model(order, par, yy_test_words, yy_test_primacy, 27)[1:12]
  return(sum((mod-human_perf)^2))
}

yy_meanSSE_recency <- function(par, order, human_perf) {
  mod = test_model(order, par, yy_test_words, yy_test_recency, 27)[1:12]
  return(sum((mod-human_perf)^2))
}

yy_meanSSE_both <- function(par, order, human_perf) {
  mod = test_model(order, par, yy_test_words, yy_test_both, 27)
  return(sum((mod-human_perf)^2))
}

yy_meanSSE_expt <- function(par, order, human_perf) {
  return(sum(yy_meanSSE_primacy(par, order$primacy, unlist(order$primacy$HumanItemAcc)),
             yy_meanSSE_recency(par, order$recency, unlist(order$recency$HumanItemAcc)),
             yy_meanSSE_both(par, order$both, unlist(order$both$HumanItemAcc))
             ))
}

yy_meanSSE <- function(par, order, human_perf) {
  return(sum(yy_meanSSE_expt(par, order$one, NA), yy_meanSSE_expt(par, order$two, NA)))
}
```

```{r yu_yurovsky_fit_expt1}

yy_1_p_mod_fit <- fit_model("kachergis", yy_1_primacy, c(.001,.1,.5), c(5,15,1), 
                            yy_meanSSE_primacy) 

yy_1_r_mod_fit <- fit_model("kachergis", yy_1_recency, c(.001,.1,.5), c(5,15,1), 
                            yy_meanSSE_recency)

yy_1_b_mod_fit <- fit_model("kachergis", yy_1_both, c(.001,.1,.5), c(5,15,1), 
                            yy_meanSSE_both) 

yy_1_mod_fit <- fit_model("kachergis", yy_1_expt, c(.001,.1,.5), c(5,15,1),
                          yy_meanSSE_expt)
```

```{r yu_yurovsky_fit_expt2}

yy_2_p_mod_fit <- fit_model("kachergis", yy_2_primacy, c(.001,.1,.5), c(5,15,1), 
                            yy_meanSSE_primacy) 

yy_2_r_mod_fit <- fit_model("kachergis", yy_2_recency, c(.001,.1,.5), c(5,15,1), 
                            yy_meanSSE_recency)

yy_2_b_mod_fit <- fit_model("kachergis", yy_2_both, c(.001,.1,.5), c(5,15,1), 
                            yy_meanSSE_both) 

yy_2_mod_fit <- fit_model("kachergis", yy_2_expt, c(.001,.1,.5), c(5,15,1),
                          yy_meanSSE_expt)
```

```{r yu_yurovsky_fit_expt_all}
yy_mod_fit <- fit_model("kachergis", yy_expt, c(.001,.1,.5), c(5,15,1),
                          yy_meanSSE)
```

```{r yu_yurovsky_params}
print("the best parameters tuned by condition are:")

print(paste0("expt 1 primacy: ", paste0(unlist(yy_1_p_mod_fit), collapse=", ")))
print(paste0("expt 1 recency: ", paste0(unlist(yy_1_r_mod_fit), collapse=", ")))
print(paste0("expt 1 both: ", paste0(unlist(yy_1_b_mod_fit), collapse=", ")))

print(paste0("expt 2 primacy: ", paste0(unlist(yy_2_p_mod_fit), collapse=", ")))
print(paste0("expt 2 recency: ", paste0(unlist(yy_2_r_mod_fit), collapse=", ")))
print(paste0("expt 2 both: ", paste0(unlist(yy_2_b_mod_fit), collapse=", ")))

print("the best parameters tuned by expt are:")

print(paste0("expt 1: ", paste0(unlist(yy_1_mod_fit), collapse=", ")))
print(paste0("expt 2: ", paste0(unlist(yy_2_mod_fit), collapse=", ")))

print("the best parameters tuned overall are:")

print(paste0(unlist(yy_1_mod_fit), collapse=", "))
```

### Results

```{r yu_yurovsky_result_fn}
yy_run_expt <- function(expt, prim_par, rec_par, both_par) {
  results = matrix(0, 1, 7)
  if(expt == 1) {
    yy_p <- test_model(yy_1_primacy, prim_par, yy_test_words, yy_test_primacy, 27)[1:12]
    yy_r <- test_model(yy_1_recency, rec_par, yy_test_words, yy_test_recency, 27)[1:12]
    yy_b <- test_model(yy_1_both, both_par, yy_test_words, yy_test_both, 27)
  } else {
    yy_p <- test_model(yy_2_primacy, prim_par, yy_test_words, yy_test_primacy, 27)[1:12]
    yy_r <- test_model(yy_2_recency, rec_par, yy_test_words, yy_test_recency, 27)[1:12]
    yy_b <- test_model(yy_2_both, both_par, yy_test_words, yy_test_both, 27)
  }
  results[1, 1] = mean(yy_p[7:12])
  results[1, 2] = mean(yy_r[7:12])
  results[1, 3] = mean(yy_b[7:12])
  
  results[1, 4] = mean(yy_p[1:6])
  results[1, 5] = mean(yy_r[1:6])
  results[1, 6] = mean(yy_b[1:6])
  results[1, 7] = mean(yy_b[13:18])

  return(round(results, 3))
}
```

```{r yu_yurovsky_results}
print("Experiment 1 tuned to each condtiion")
paste0(yy_run_expt(1, yy_1_p_mod_fit, yy_1_r_mod_fit, yy_1_b_mod_fit), collapse=", ")

print("Experiment 2 tuned to each condtiion")
paste0(yy_run_expt(2, yy_2_p_mod_fit, yy_2_r_mod_fit, yy_2_b_mod_fit), collapse=", ")

print("Experiment 1 tuned to massed")
paste0(yy_run_expt(1, yy_1_mod_fit, yy_1_mod_fit, yy_1_mod_fit), collapse=", ")

print("Experiment 2 tuned to interleaved")
paste0(yy_run_expt(2, yy_2_mod_fit, yy_2_mod_fit, yy_2_mod_fit), collapse=", ")

print("Experiment 1 & 2 tuned to total expt")
paste0(yy_run_expt(1, yy_mod_fit, yy_mod_fit, yy_mod_fit), collapse=", ")
paste0(yy_run_expt(2, yy_mod_fit, yy_mod_fit, yy_mod_fit), collapse=", ")

```

## Yu & Smith
### Input
```{r yu_smith_words_objects}
yu_smith_4_wo <- matrix(c( 1,  4,  7, 16,   2,  9, 10, 13,   5, 15, 17, 18,
                        4,  7,  9, 17,   3,  6, 12, 14,  10, 14, 16, 18,
                        6,  8, 11, 12,   1,  3, 11, 13,   9, 10, 13, 18,
                        4, 15, 16, 17,   2,  5,  8, 15,   3,  5,  7, 11,
                        7, 11, 13, 15,   3,  5,  6, 12,   9, 10, 12, 17,
                        1,  2,  8, 18,   1,  6,  8, 16,   3,  5, 10, 17,
                        1,  5, 11, 15,   1,  7, 16, 17,  13, 14, 15, 18,
                        2,  8,  9, 12,   9, 10, 13, 14,   4,  6,  7, 16, 
                        2,  8, 11, 14,   3,  4,  6, 12,   2,  4,  8, 14
                       ),
                     nrow = 27,
                     ncol = 4, byrow=T
                     )

yu_smith_3_wo <- matrix(c( 1,  6, 17,   8,  7, 15,   4, 13, 17,   3,  2, 16,
                        8,  9, 16,   1,  5, 14,   2,  9, 11,   8, 12, 13,
                        4,  7, 11,   1,  8, 10,   7,  5, 17,   3,  6, 15,
                        4,  2, 10,   3, 11, 17,   2,  5,  6,   1, 13, 15,
                        8, 14, 18,   4,  9, 15,   3, 13, 18,   5, 11, 15,
                       15, 18, 16,   5, 10, 18,   9, 12, 18,  10, 12, 17,
                        4,  5, 16,   6, 10, 13,   8, 11,  6,   2, 12, 14,
                        7,  9, 10,   1, 3,  9,    6, 14, 16,   2, 17, 18,
                        4,  3, 14,   7, 13, 14,   1, 11, 12,   7, 16, 12
                       ),
                     nrow = 36,
                     ncol = 3, byrow=T
                     )

yu_smith_2_wo <- matrix(c( 5, 10,   4,  5,   6, 15,   1,  6,  12, 15,  15, 10, 
                        7,  8,  14, 12,   7, 18,  14, 15,   1,  4,   7, 17, 
                        3, 13,  10, 17,   5,  9,  11, 18,   2,  9,  17,  2, 
                        9, 13,   7,  1,  17, 10,  13,  6,   1,  2,   3, 15, 
                        8, 11,  12,  3,  11, 12,  16,  3,   3, 14,   4, 17, 
                        2, 18,   8,  9,  11, 13,   3,  1,  13, 17,   2,  8, 
                        4,  6,   4,  7,  16, 18,   5,  1,   6, 14,  16, 10, 
                        5, 11,   7, 16,   8, 10,   2, 11,  14, 18,  12,  9, 
                       13, 16,   5,  8,   9, 14,  16, 15,   6, 12,   4, 18 
                       ),
                     nrow = 54,
                     ncol = 2, byrow=T
                     )
```

```{r yu_smith_input}

yu_smith_4 <- list("train" = list("words" = yu_smith_4_wo, 
                                  "objs" = yu_smith_4_wo), 
                   "Nsubj" = 40, 
                   "Condition" = "Yu_smith_4x4", 
                   "HumanItemAcc" = c(0.53, 0.53, 0.53, 0.53, 0.53, 0.53,
                                      0.53, 0.53, 0.53, 0.53, 0.53, 0.53,
                                      0.53, 0.53, 0.53, 0.53, 0.53, 0.53))

yu_smith_3 <- list("train" = list("words" = yu_smith_3_wo, 
                                  "objs" = yu_smith_3_wo), 
                   "Nsubj" = 40, 
                   "Condition" = "Yu_smith_3x3", 
                   "HumanItemAcc" = c(0.76, 0.76, 0.76, 0.76, 0.76, 0.76, 
                                      0.76, 0.76, 0.76, 0.76, 0.76, 0.76, 
                                      0.76, 0.76, 0.76, 0.76, 0.76, 0.76))

yu_smith_2 <- list("train" = list("words" = yu_smith_2_wo, 
                                  "objs" = yu_smith_2_wo), 
                   "Nsubj" = 40, 
                   "Condition" = "Yu_smith_2x2", 
                   "HumanItemAcc" = c(0.89, 0.89, 0.89, 0.89, 0.89, 0.89, 
                                      0.89, 0.89, 0.89, 0.89, 0.89, 0.89, 
                                      0.89, 0.89, 0.89, 0.89, 0.89, 0.89))


yu_smith_all <- list("two" = yu_smith_2, "three" = yu_smith_3, "four" = yu_smith_4,
                     "Condition" = "Yu Smith")
```

### Fit functions
```{r yu_smith_fit}

yu_smith_4_mod_fit <- fit_model("kachergis", yu_smith_4, 
                                c(.001,.1,.5), c(5,15,1), meanSSE)

yu_smith_3_mod_fit <- fit_model("kachergis", yu_smith_3, 
                                c(.001,.1,.5), c(5,15,1), meanSSE)

yu_smith_2_mod_fit <- fit_model("kachergis", yu_smith_2, 
                                c(.001,.1,.5), c(5,15,1), meanSSE)

```

```{r fit_all_yu_smith}
yu_smith_meanSSE <- function(par, order, human_perf) {
  mod2 = model(par, order$two$train)
  mod3 = model(par, order$three$train)
  mod4 = model(par, order$four$train)
  return(sum((mod2$perf-order$two$HumanItemAcc)^2) + 
           sum((mod3$perf-order$three$HumanItemAcc)^2) +
           sum((mod4$perf-order$four$HumanItemAcc)^2))
}
```

```{r yu_smith_fit_all}
yu_smith_mod_fit <- fit_model("kachergis", yu_smith_all, c(.001,.1,.5), c(5,15,1), yu_smith_meanSSE)
```

### Results
```{r yu_smith_result_fn}
yu_smith_get_results <- function(param2, param3, param4) {
  mod4 = run_model(yu_smith_4, param4)
  mod3 = run_model(yu_smith_3, param3)
  mod2 = run_model(yu_smith_2, param2)
  
  return(paste0(round(c(mean(mod4$perf), mean(mod3$perf), mean(mod2$perf)), 3), collapse=", "))
}
```

```{r yu_smith_results}
yu_smith_get_results(yu_smith_2_mod_fit, yu_smith_3_mod_fit, yu_smith_4_mod_fit)

yu_smith_get_results(yu_smith_mod_fit, yu_smith_mod_fit, yu_smith_mod_fit)
```


## Suanda, Mugwanya, & Namy, 2014

We generated these inputs from the paper

### Input
```{r suanda_words_objs}
suanda_high_cd_wo <- matrix(c(2, 1, 4, 3, 6, 7, 8, 5, 
                           1, 3, 2, 4, 7, 5, 8, 6, 
                           2, 6, 3, 7, 1, 5, 4, 8, 
                           2, 3, 5, 6, 7, 8, 1, 4
                           ),
                         nrow = 16, ncol = 2, byrow = T)

suanda_med_cd_wo  <- matrix(c(2, 1, 8, 7, 3, 4, 5, 6, 
                           1, 3, 6, 7, 4, 2, 5, 8, 
                           2, 1, 7, 5, 3, 4, 6, 8, 
                           5, 6, 2, 3, 7, 8, 1, 4
                           ),
                         nrow = 16, ncol = 2, byrow = T)

suanda_low_cd_wo  <- matrix(c(2, 1, 7, 8, 5, 6, 3, 4, 
                           1, 2, 5, 7, 6, 8, 3, 4,
                           1, 3, 5, 6, 7, 8, 1, 2, 
                           3, 4, 5, 6, 2, 4, 7, 8
                           ),
                         nrow = 16, ncol = 2, byrow = T)
```

```{r suanda_test_input}
suanda_test_words <- matrix(c(
  1, 2, 3, 4, 5, 6, 7, 8
),
nrow = 8,
ncol = 1, byrow = T)

suanda_test_high <- matrix(c(
  1, 6, 7, 8,  2, 5, 7, 8,  3, 5, 6, 8,  4, 5, 6, 7,
  5, 2, 3, 4,  6, 1, 3, 4,  7, 1, 2, 4,  8, 1, 2, 3
),
nrow = 8,
ncol = 4, byrow = T)

suanda_test_med <- matrix(c(
  1, 5, 6, 7,  2, 5, 6, 8,  3, 6, 7, 8,  4, 5, 7, 8,
  5, 1, 2, 3,  6, 2, 3, 4,  7, 1, 2, 4,  8, 1, 3, 4
),
nrow = 8,
ncol = 4, byrow = T)

suanda_test_low <- matrix(c(
  1, 4, 5, 7,  2, 3, 6, 8,  3, 5, 7, 8,  4, 2, 3, 6,
  5, 2, 4, 7,  6, 1, 4, 8,  7, 1, 2, 6,  8, 1, 3, 5
),
nrow = 8,
ncol = 4, byrow = T)

```

```{r suanda_input}
suanda_high_cd <- list("train" = list("words" = suanda_high_cd_wo, 
                                      "objs" = suanda_high_cd_wo), 
                       "Nsubj" = 40, 
                       "Condition" = "Suanda_high_cd", 
                       "HumanItemAcc" = c(0.48, 0.48, 0.48, 0.48,
                                          0.48, 0.48, 0.48, 0.48))

suanda_med_cd <- list("train" = list("words" = suanda_med_cd_wo, 
                                     "objs" = suanda_med_cd_wo), 
                      "Nsubj" = 40, "Condition" = "Suanda_med_cd", 
                      "HumanItemAcc" = c(0.39, 0.39, 0.39, 0.39,
                                         0.39, 0.39, 0.39, 0.39))

suanda_low_cd <- list("train" = list("words" = suanda_low_cd_wo, 
                                     "objs" = suanda_low_cd_wo), 
                      "Nsubj" = 40, 
                   "Condition" = "Suanda_low_cd", 
                   "HumanItemAcc" = c(0.34, 0.34, 0.34, 0.34,
                                      0.34, 0.34, 0.34, 0.34))

suanda_expt <- list("high" = suanda_high_cd, 
                   "medium" = suanda_med_cd, 
                   "low" = suanda_low_cd, 
                   "Condition" = "Suanda")

```

### Fit functions
```{r suanda_sse_fn}
suanda_meanSSE_high <- function(par, order, human_perf) {
  mod = test_model(order, par, suanda_test_words, suanda_test_high, 16)
  return(sum((mod-unlist(order$HumanItemAcc))^2))
}

suanda_meanSSE_med <- function(par, order, human_perf) {
  mod = test_model(order, par, suanda_test_words, suanda_test_med, 16)
  return(sum((mod-unlist(order$HumanItemAcc))^2))
}

suanda_meanSSE_low <- function(par, order, human_perf) {
  mod = test_model(order, par, suanda_test_words, suanda_test_low, 16)
  return(sum((mod-unlist(order$HumanItemAcc))^2))
}

suanda_meanSSE <- function(par, order, human_perf) {
  return(sum(suanda_meanSSE_high(par, order$high, unlist(order$high$HumanItemAcc)),
             suanda_meanSSE_med(par, order$medium, unlist(order$medium$HumanItemAcc)),
             suanda_meanSSE_low(par, order$low, unlist(order$low$HumanItemAcc))))
}
```

```{r suanda_fit_all}
suanda_high_mod_fit <- fit_model("kachergis", suanda_high_cd, c(.001,.1,.5), c(5,15,1), 
                            suanda_meanSSE_high)
  
suanda_med_mod_fit <- fit_model("kachergis", suanda_med_cd, c(.001,.1,.5), c(5,15,1), 
                            suanda_meanSSE_med) 

suanda_low_mod_fit <- fit_model("kachergis", suanda_low_cd, c(.001,.1,.5), c(5,15,1), 
                            suanda_meanSSE_low) 

suanda_mod_fit <- fit_model("kachergis", suanda_expt, c(.001,.1,.5), c(5,15,1), 
                            suanda_meanSSE) 
```

```{r suanda_params}
suanda_high_mod_fit
suanda_med_mod_fit
suanda_low_mod_fit
suanda_mod_fit
```

### Results
```{r suanda_result_fn}
suanda_get_results <- function(high_par, med_par, low_par) {
  mod_high = test_model(suanda_high_cd, high_par, suanda_test_words, suanda_test_high, 16)
  mod_med = test_model(suanda_med_cd, med_par, suanda_test_words, suanda_test_med, 16)
  mod_low = test_model(suanda_low_cd, low_par, suanda_test_words, suanda_test_low, 16)
  return(list(round(c(mean(mod_high), mean(mod_med), mean(mod_low)), 3)))
}
```

```{r suanda_results}
suanda_get_results(suanda_high_mod_fit, suanda_med_mod_fit, suanda_low_mod_fit)
suanda_get_results(suanda_mod_fit, suanda_mod_fit, suanda_mod_fit)
```

### Range of possible results
```{r suanda_range}
min_high = 1
max_high = 0
min_med = 1
max_med = 0
min_low = 1
max_low = 0

suanda_values <- tibble(condition = c(), chi = c(), lambda = c(), alpha = c(), performance = c())
for(gamma in c(0.001, 0.01, 0.05, 0.1, 0.5, 1, 2, 3, 4, 5)) {
  for(lambda in c(0.1, 0.3, 0.5, 0.8, 1, 2, 3, 5, 10, 15)) {
    for(alpha in c(0.5, 0.6, 0.7, 0.8, 0.9, 0.92, 0.95, 0.96, 0.99, 1)) {
      high = suanda_get_results(c(gamma, lambda, alpha), c(gamma, lambda, alpha),
                   c(gamma, lambda, alpha))[[1]][1]
      if(high < min_high) {min_high = high}
      if(high > max_high) {max_high = high}
      if(high < 0.26 & high > 0.24) {
        print(c("high", gamma, lambda, alpha, high))
      }
      med = suanda_get_results(c(gamma, lambda, alpha), c(gamma, lambda, alpha),
                   c(gamma, lambda, alpha))[[1]][2]
      if(med < min_med) {min_med = med}
      if(med > max_med) {max_med = med}
      if(med < 0.26 & med > 0.24) {
        print(c("med", gamma, lambda, alpha, med))
      }
      low = suanda_get_results(c(gamma, lambda, alpha), c(gamma, lambda, alpha),
                   c(gamma, lambda, alpha))[[1]][3]
      if(low < min_low) {min_low = low}
      if(low > max_low) {max_low = low}
      if(low < 0.26 & low > 0.24) {
        print(c("low", gamma, lambda, alpha, low))
      }
      suanda_values <- rbind(suanda_values, 
                             tibble(condition = c("high", "med", "low"), 
                                    chi = c(gamma, gamma, gamma), 
                                    lambda = c(lambda, lambda, lambda), 
                                    alpha = c(alpha, alpha, alpha), 
                                    performance = c(high, med, low)))
    }
  }
}
min_high
max_high
min_med
max_med
min_low
max_low

suanda_values
```

```{r suanda_range_graph}
ggplot(data = suanda_values, aes(x=lambda, y = performance, color = condition)) +
  geom_point(aes(shape = condition)) +
  facet_grid(cols = vars(alpha), rows = vars(chi))
```
